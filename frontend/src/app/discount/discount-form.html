<div class="container mt-4" [class.opacity-50]="loading">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>{{ (isEdit ? 'DISCOUNT_FORM.EDIT_TITLE' : 'DISCOUNT_FORM.CREATE_TITLE') | translate }}</h2>
    <a class="btn btn-secondary" [routerLink]="['/discounts']">{{ 'DISCOUNT_FORM.BUTTON_BACK' | translate }}</a>
  </div>

  @if (errorKey) {
    <div class="alert alert-danger">{{ errorKey | translate:errorArgs }}</div>
    @if (validationMessages.length) {
      <ul class="mt-2 mb-0">
        @for (m of validationMessages; track m) {
          <li>{{ m }}</li>
        }
      </ul>
    }
  }

  <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">{{ 'DISCOUNT_FORM.FIELDS.CODE' | translate }}</label>
        <input class="form-control" formControlName="discountCode" maxlength="20" />
        @if (form.get('discountCode')?.touched && form.get('discountCode')?.invalid) {
          <div class="invalid-feedback d-block">{{ 'DISCOUNT_FORM.VALIDATION.CODE_REQUIRED' | translate }}</div>
        }
      </div>

      <div class="col-md-4">
        <label class="form-label">{{ 'DISCOUNT_FORM.FIELDS.PERCENTAGE' | translate }}</label>
        <input type="number" class="form-control" formControlName="discountPercentage" min="1" max="100" />
        @if (form.get('discountPercentage')?.touched && form.get('discountPercentage')?.invalid) {
          <div class="invalid-feedback d-block">{{ 'DISCOUNT_FORM.VALIDATION.PERCENTAGE_RANGE' | translate }}</div>
        }
      </div>

      <div class="col-md-4">
        <label class="form-label">{{ 'DISCOUNT_FORM.FIELDS.EXPIRY_DATE' | translate }}</label>
        <input type="date" class="form-control" formControlName="expiryDate" />
        @if (form.get('expiryDate')?.touched && form.get('expiryDate')?.invalid) {
          <div class="invalid-feedback d-block">{{ 'DISCOUNT_FORM.VALIDATION.EXPIRY_REQUIRED' | translate }}</div>
        }
      </div>
    </div>

    <div class="mt-4">
      <label class="form-label">{{ 'DISCOUNT_FORM.FIELDS.TYPES_LABEL' | translate }}</label>
      <div class="row">
        @for (tt of allTicketTypes; track tt.id) {
          <div class="col-md-6 col-lg-4 mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" [checked]="selectedNames.has(tt.typeName)" (change)="toggleTypeName(tt.typeName, ($any($event.target)?.checked ?? false))" id="ck-{{tt.id}}">
              <label class="form-check-label" [for]="'ck-' + tt.id">
                {{ tt.typeName }} ({{ tt.currency }} {{ tt.cost }})
              </label>
            </div>
          </div>
        }
      </div>
    </div>

    <div class="d-flex gap-2 mt-4">
      <button type="submit" [disabled]="loading" class="btn btn-primary">{{ 'DISCOUNT_FORM.BUTTON_SAVE' | translate }}</button>
      @if (isEdit) {
        <button type="button" [disabled]="loading" class="btn btn-outline-danger" (click)="delete()">{{ 'DISCOUNT_FORM.BUTTON_DELETE' | translate }}</button>
      }
    </div>
  </form>
</div>
